<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Folha</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
font-family:Arial;
background:#0f172a;
color:white;
padding:20px;
}

.box{
max-width:600px;
margin:auto;
background:#111827;
padding:25px;
border-radius:12px;
}

input,textarea{
width:100%;
padding:12px;
margin-bottom:12px;
border-radius:8px;
border:none;
}

button{
padding:12px;
background:#2563eb;
color:white;
border:none;
width:100%;
border-radius:8px;
font-weight:bold;
cursor:pointer;
}

.login{
position:fixed;
top:0;
left:0;
right:0;
bottom:0;
background:black;
display:flex;
align-items:center;
justify-content:center;
}
</style>
</head>

<body>

<div class="login" id="login">
<div class="box">
<h2>Senha</h2>
<input type="password" id="senha">
<button onclick="entrar()">Entrar</button>
<p id="erro"></p>
</div>
</div>

<div class="box">
<h2>Enviar Folha</h2>

<label>Mês</label>
<input type="month" id="mes" disabled>

<label>Matrícula</label>
<input list="listaMat" id="matricula">
<datalist id="listaMat"></datalist>

<label>Nome</label>
<input list="listaNome" id="nome">
<datalist id="listaNome"></datalist>

<label>Função</label>
<input id="funcao" readonly>

<label>Vínculo</label>
<input id="vinculo" readonly>

<label>Carga</label>
<input id="carga" readonly>

<label>Escola</label>
<input id="escola" readonly>

<label>Faltas</label>
<input type="number" id="faltas">

<label>Falta com atestado</label>
<input type="number" id="falta">

<label>Horas extras</label>
<input type="number" id="he">

<label>Observações</label>
<textarea id="obs"></textarea>

<button onclick="enviar()">ENVIAR</button>

<p id="msg"></p>
</div>

<script>
if(localStorage.getItem("logado")=="1"){
document.getElementById("login").style.display="none";
}

function entrar(){
if(document.getElementById("senha").value=="2026"){
localStorage.setItem("logado","1");
location.reload();
}else{
document.getElementById("erro").innerText="Senha errada";
}
}

// mês atual
let d=new Date();
let mes=(d.getMonth()+1).toString().padStart(2,"0");
let atual=d.getFullYear()+"-"+mes;
document.getElementById("mes").value=atual;

// carregar funcionarios
fetch("/api/funcionarios")
.then(r=>r.json())
.then(d=>{
let lista=d.funcionarios;

lista.forEach(f=>{
let o=document.createElement("option");
o.value=f.matricula;
listaMat.appendChild(o);

let n=document.createElement("option");
n.value=f.nome;
listaNome.appendChild(n);
});

window.funcs=lista;
});

matricula.oninput=preencher;
nome.oninput=preencher;

function preencher(){
let m=matricula.value;
let n=nome.value;

let f=funcs.find(x=>x.matricula==m||x.nome==n);
if(!f) return;

nome.value=f.nome;
matricula.value=f.matricula;
funcao.value=f.funcao;
vinculo.value=f.vinculo;
carga.value=f.carga;
escola.value=f.escola;
}

function enviar(){
let data={
periodo:mes.value,
matricula:matricula.value,
nome:nome.value,
funcao:funcao.value,
vinculo:vinculo.value,
carga:carga.value,
escola:escola.value,
faltas:faltas.value,
falta_com_atestado:falta.value,
horas_extras:he.value,
observacoes:obs.value
};

fetch("/api/folha/enviar",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify(data)
})
.then(r=>r.json())
.then(r=>{
msg.innerText="Enviado!";
});
}
</script>
</body>
</html>
